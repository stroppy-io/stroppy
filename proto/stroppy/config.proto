syntax = "proto3";

package stroppy;

import "proto/stroppy/common.proto";
import "proto/stroppy/descriptor.proto";
import "validate/validate.proto";

option go_package = "github.com/stroppy-io/stroppy/pkg/common/proto/stroppy";

/**
 * DriverConfig contains configuration for connecting to a database driver.
 * It includes the driver plugin path, connection URL, and database-specific
 * settings.
 */
message DriverConfig {
  /** Database connection URL */
  string url = 1 [ (validate.rules).string.uri_ref = true ];
  /** Database-specific configuration options */
  optional Value.Struct db_specific = 2;

  enum DriverType {
    DRIVER_TYPE_UNSPECIFIED = 0;
    DRIVER_TYPE_POSTGRES = 1;
    DRIVER_TYPE_PICODATA = 2;
  }

  /** Name/Type of chosen driver */
  DriverType driver_type = 3 [ (validate.rules).enum.defined_only = true ];
}

/**
 * LoggerConfig contains configuration for the logging system.
 * It controls log levels and output formatting.
 */
message LoggerConfig {
  enum LogLevel {
    LOG_LEVEL_DEBUG = 0;
    LOG_LEVEL_INFO = 1;
    LOG_LEVEL_WARN = 2;
    LOG_LEVEL_ERROR = 3;
    LOG_LEVEL_FATAL = 4;
  }
  enum LogMode {
    LOG_MODE_DEVELOPMENT = 0;
    LOG_MODE_PRODUCTION = 1;
  }
  /** Minimum log level to output */
  LogLevel log_level = 1 [ (validate.rules).enum.defined_only = true ];
  /** Logging mode (development or production) */
  LogMode log_mode = 2 [ (validate.rules).enum.defined_only = true ];
}

/**
 * OtlpExporterConfig contains named configuration for an OTLP exporter.
 */
message ExporterConfig {
  /** Name of the OTLP exporter */
  string name = 1 [ (validate.rules).string.min_len = 1 ];
  /** Configuration for the OTLP exporter */
  stroppy.OtlpExport otlp_export = 2
      [ (validate.rules).message.required = true ];
}

message GlobalConfig {
  /**
   * Version of the configuration format e.g. proto files version.
   * This is used for backward compatibility of configs
   * and will be set automatically from binary run if not present.
   */
  string version = 1;
  /**
   * Run identifier for reproducible test runs or debugging
   * If set to "generate()" stroppy eval ulid for run_id
   */
  string run_id = 2;
  /** Random seed for reproducible test runs */
  uint64 seed = 3 [ (validate.rules).uint64.gte = 0 ];
  /** Arbitrary metadata, may be passed to result labels and json output */
  map<string, string> metadata = 4;
  /** Database driver configuration */
  stroppy.DriverConfig driver = 5 [ (validate.rules).message.required = true ];
  /** Logging configuration */
  stroppy.LoggerConfig logger = 6;
  /** Exporter configuration */
  stroppy.ExporterConfig exporter = 7;
}
