syntax = "proto3";

package stroppy;

import "google/protobuf/duration.proto";

import "proto/stroppy/common.proto";
import "proto/stroppy/config.proto";
import "proto/stroppy/descriptor.proto";

option go_package = "github.com/stroppy-io/stroppy/pkg/common/proto/stroppy";

/**
 * DriverQuery represents a query that can be executed by a database driver.
 */
message DriverQuery {
  /** Request of the query */
  string request = 1;
  /** Parameters of the query */
  repeated Value params = 2;
  /** If alternate insertion method required */
  optional InsertMethod method = 3;
}

/**
 * DriverTransaction represents a transaction that can be executed by a database
 * driver.
 */
message DriverTransaction {
  /** Queries of the transaction */
  repeated DriverQuery queries = 1;
  /** Isolation level of the transaction */
  TxIsolationLevel isolation_level = 2;
}

/**
 * DriverQueryStat represent an actual time spent on single query.
 * exec_duration includes the network round-trip and exection on dbms.
 */
message DriverQueryStat {
  string name = 1;
  google.protobuf.Duration exec_duration = 2;
}

/**
 * DriverTransactionStat represents an actual time spent on transaction.
 * exec_duration includes the network round-trip and exection on dbms.
 */
message DriverTransactionStat {
  repeated DriverQueryStat queries = 1;
  google.protobuf.Duration exec_duration = 2;
  TxIsolationLevel isolation_level = 3;
}
