# Production конфигурация для Stroppy Cloud Panel
# Этот файл показывает, как переопределить настройки для production окружения

stroppy-cloud-pannel:
  secrets:
    stroppy-cloud-pannel-env:
      # Production значения для переменных окружения
      DB_HOST: postgres-prod.example.com
      DB_PORT: "5432"
      DB_USER: stroppy_prod
      DB_PASSWORD: "your-secure-production-password"
      DB_NAME: stroppy_production
      DB_SSLMODE: require
      PORT: "8080"
      JWT_SECRET: "your-very-secure-jwt-secret-key-for-production"

  # Дополнительные аннотации для секретов
  secretsAnnotations:
    kubernetes.io/managed-by: "Helm"
    app.kubernetes.io/part-of: "stroppy-cloud-pannel"

  # Production ресурсы
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Production реплики
  replicaCount: 3

  # Production пробы с настройками для production
  livenessProbe:
    httpGet:
      path: /healthz/liveness
      port: http
    initialDelaySeconds: 60
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 5
    successThreshold: 1

  readinessProbe:
    httpGet:
      path: /healthz/readiness
      port: http
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
    successThreshold: 1

  # Production порты
  appPorts:
    grpc: 50050
    http: 8080

  # Production сервис
  service:
    enabled: true
    type: ClusterIP
    useAllAppPorts: false
    ports:
      grpc: 50050
      http: 8080

  # Production ingress (если нужен)
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      kubernetes.io/ingress.class: nginx
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: stroppy.company.com
        paths:
          - path: /
            pathType: Prefix
            portName: http
    tls:
      - secretName: stroppy-tls
        hosts:
          - stroppy.company.com

  # Production автоподстройка
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  # Production node selector
  nodeSelector:
    kubernetes.io/os: linux
    node-type: production

  # Production tolerations
  tolerations:
    - key: "production"
      operator: "Equal"
      value: "true"
      effect: "NoSchedule"

  # Production affinity
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
              - stroppy-cloud-pannel
          topologyKey: kubernetes.io/hostname
