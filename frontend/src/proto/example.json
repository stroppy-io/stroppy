{
  "$schema": "https://github.com/stroppy-io/stroppy-proto/releases/download/v1.0.2-14-g90146d6/config.schema.json",
  "global": {
    "version": "v1.0.2-14-g90146d6",
    "runId": "b46baed9-d0be-449c-8fc7-9523b37b77e2",
    "seed": "1759228843",
    "metadata": {
      "example": "stroppy_metadata"
    },
    "driver": {
      "url": "postgres://postgres:postgres@localhost:5432/postgres?sslmode=disable",
      "dbSpecific": {
        "fields": [
          {
            "string": "debug",
            "key": "trace_log_level"
          },
          {
            "string": "1m",
            "key": "max_conn_lifetime"
          },
          {
            "string": "30s",
            "key": "max_conn_idle_time"
          },
          {
            "int32": 100,
            "key": "max_conns"
          },
          {
            "int32": 1,
            "key": "min_conns"
          },
          {
            "int32": 10,
            "key": "min_idle_conns"
          }
        ]
      },
      "driverType": "DRIVER_TYPE_POSTGRES"
    },
    "logger": {
      "logLevel": "LOG_LEVEL_DEBUG",
      "logMode": "LOG_MODE_PRODUCTION"
    }
  },
  "exporters": [
    {
      "name": "otlp-cloud-export",
      "otlpExport": {
        "otlpGrpcEndpoint": "localhost:4317",
        "otlpMetricsPrefix": "k6_"
      }
    }
  ],
  "executors": [
    {
      "name": "single-vus-single-step",
      "k6": {
        "scenario": {
          "perVuIterations": {
            "vus": 1,
            "iterations": "1"
          }
        }
      }
    },
    {
      "name": "max-workload",
      "k6": {
        "scenario": {
          "constantArrivalRate": {
            "rate": 1000,
            "timeUnit": "1s",
            "preAllocatedVus": 1,
            "maxVus": 100
          }
        }
      }
    }
  ],
  "steps": [
    {
      "name": "create_tablessssssss",
      "workload": "test_table",
      "executor": "single-vus-single-step",
      "exporter": "otlp-cloud-export"
    }
  ],
  "benchmark": {
    "name": "example",
    "workloads": [
      {
        "name": "test_table",
        "units": [
          {
            "descriptor": {
              "query": {
                "name": "test_table_q",
                "sql": "CREATE TABLE some_test (id INT PRIMARY KEY)"
              }
            },
            "count": "1"
          }
        ]
      },
      {
        "name": "create_table",
        "units": [
          {
            "descriptor": {
              "createTable": {
                "name": "users",
                "columns": [
                  {
                    "name": "id",
                    "sqlType": "INT",
                    "primaryKey": true
                  },
                  {
                    "name": "name",
                    "sqlType": "TEXT",
                    "nullable": true
                  },
                  {
                    "name": "email",
                    "sqlType": "TEXT",
                    "constraint": "NOT NULL"
                  }
                ]
              }
            },
            "count": "1"
          }
        ]
      },
      {
        "name": "insert_data",
        "units": [
          {
            "descriptor": {
              "query": {
                "name": "insert",
                "sql": "INSERT INTO users (id, name, email) VALUES (${id}, ${name}, ${email})",
                "params": [
                  {
                    "name": "id",
                    "generationRule": {
                      "int32Rules": {
                        "range": {
                          "min": 1,
                          "max": 100000
                        }
                      },
                      "distribution": {
                        "type": "ZIPF",
                        "screw": 1.1
                      },
                      "unique": true
                    }
                  },
                  {
                    "name": "name",
                    "generationRule": {
                      "stringRules": {
                        "alphabet": {
                          "ranges": [
                            {
                              "min": 65,
                              "max": 90
                            },
                            {
                              "min": 97,
                              "max": 122
                            }
                          ]
                        },
                        "lenRange": {
                          "min": "1",
                          "max": "100"
                        }
                      }
                    }
                  },
                  {
                    "name": "email",
                    "generationRule": {
                      "stringRules": {
                        "alphabet": {
                          "ranges": [
                            {
                              "min": 65,
                              "max": 90
                            },
                            {
                              "min": 97,
                              "max": 122
                            }
                          ]
                        },
                        "lenRange": {
                          "min": "10",
                          "max": "50"
                        }
                      }
                    }
                  }
                ]
              }
            },
            "count": "100000"
          }
        ]
      },
      {
        "name": "warm_up",
        "units": [
          {
            "descriptor": {
              "query": {
                "name": "select",
                "sql": "SELECT * FROM users WHERE id = ${id}",
                "params": [
                  {
                    "name": "id",
                    "generationRule": {
                      "int32Rules": {
                        "range": {
                          "min": 1,
                          "max": 100
                        }
                      }
                    }
                  }
                ]
              }
            },
            "count": "1000"
          }
        ]
      },
      {
        "name": "select_data",
        "units": [
          {
            "descriptor": {
              "query": {
                "name": "select",
                "sql": "SELECT * FROM users WHERE id = ${id}",
                "params": [
                  {
                    "name": "id",
                    "generationRule": {
                      "int32Rules": {
                        "range": {
                          "min": 1,
                          "max": 100
                        }
                      }
                    }
                  }
                ]
              }
            },
            "count": "1"
          }
        ]
      },
      {
        "name": "transaction",
        "units": [
          {
            "descriptor": {
              "transaction": {
                "name": "transaction",
                "isolationLevel": "TX_ISOLATION_LEVEL_REPEATABLE_READ",
                "queries": [
                  {
                    "name": "select",
                    "sql": "SELECT * FROM users WHERE id = ${id}",
                    "params": [
                      {
                        "name": "id",
                        "generationRule": {
                          "int32Rules": {
                            "range": {
                              "min": 1,
                              "max": 100
                            }
                          }
                        }
                      }
                    ]
                  },
                  {
                    "name": "select2",
                    "sql": "SELECT * FROM users WHERE id = ${id}",
                    "params": [
                      {
                        "name": "id",
                        "generationRule": {
                          "int32Rules": {
                            "range": {
                              "min": 1,
                              "max": 100
                            }
                          }
                        }
                      }
                    ]
                  }
                ]
              }
            },
            "count": "1"
          }
        ]
      },
      {
        "name": "clean_up",
        "units": [
          {
            "descriptor": {
              "query": {
                "name": "drop users",
                "sql": "DROP TABLE users"
              }
            },
            "count": "1"
          }
        ]
      }
    ]
  }
}
