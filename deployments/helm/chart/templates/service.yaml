{{- if (index .Values "stroppy-cloud-panel").service.enabled  }}
apiVersion: v1
kind: Service
metadata:
  name: {{ include "stroppy-cloud-panel.fullname" . }}
  annotations:
    {{- if (index .Values "stroppy-cloud-panel").serviceAnnotations }}
    {{- with (index .Values "stroppy-cloud-panel").serviceAnnotations }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
    {{- end }}
  labels:
    {{- include "stroppy-cloud-panel.labels" . | nindent 4 }}
    {{- if (index .Values "stroppy-cloud-panel").extraServiceLabels }}
    {{- include "stroppy-cloud-panel.extraServiceLabels" . | nindent 4 }}
    {{- end }}
spec:
  type: {{ (index .Values "stroppy-cloud-panel").service.type }}
  ports:
  {{- if (index .Values "stroppy-cloud-panel").service.useAllAppPorts }}
  {{- range $k, $v := (index .Values "stroppy-cloud-panel").appPorts }}
    - name: {{ $k }}
      targetPort: {{ $k }}
      port: {{ $v }}
      protocol: TCP
  {{- end }}
  {{ else }}
  {{- range $k, $v := (index .Values "stroppy-cloud-panel").service.ports }}
    - name: {{ $k }}
      targetPort: {{ $k }}
      port: {{ $v }}
      protocol: TCP
  {{- end }}
  {{- end }}
  selector:
    {{- include "stroppy-cloud-panel.labels" . | nindent 4 }}
    {{- if (index .Values "stroppy-cloud-panel").extraPodLabels }}
    {{- include "stroppy-cloud-panel.extraPodLabels" . | nindent 4 }}
    {{- end }}
{{- end }}